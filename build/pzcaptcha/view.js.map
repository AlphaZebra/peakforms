{"version":3,"file":"pzcaptcha/view.js","mappings":"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","sources":["webpack://peakforms/./src/pzcaptcha/view.js"],"sourcesContent":["/* global grecaptcha */\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n\t// Load the reCAPTCHA script dynamically\n\tconst loadRecaptchaScript = () => {\n\t\tconst recaptchaBlocks = document.querySelectorAll(\n\t\t\t\".wp-block-peakforms-pzcaptcha\",\n\t\t);\n\t\tif (!recaptchaBlocks.length) return;\n\n\t\t// Get the first block's site key (they should all use the same key)\n\t\tconst siteKey = recaptchaBlocks[0].dataset.sitekey;\n\t\tif (!siteKey) {\n\t\t\trecaptchaBlocks.forEach((block) => {\n\t\t\t\tblock.innerHTML =\n\t\t\t\t\t'<p class=\"components-placeholder__error\">reCAPTCHA site key is missing.</p>';\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\t// Validate site key format (should be a string of ~40 characters)\n\t\tif (!/^[A-Za-z0-9_-]{30,50}$/.test(siteKey)) {\n\t\t\trecaptchaBlocks.forEach((block) => {\n\t\t\t\tblock.innerHTML =\n\t\t\t\t\t'<p class=\"components-placeholder__error\">Invalid reCAPTCHA site key format.</p>';\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\t// Load the reCAPTCHA script\n\t\tconst script = document.createElement(\"script\");\n\t\tscript.src = `https://www.google.com/recaptcha/api.js?onload=pzCaptchaOnload&render=explicit`;\n\t\tscript.async = true;\n\t\tscript.defer = true;\n\n\t\t// Define the callback function that Google will call when API is ready\n\t\twindow.pzCaptchaOnload = function () {\n\t\t\ttry {\n\t\t\t\t// Initialize each reCAPTCHA block\n\t\t\t\trecaptchaBlocks.forEach((block) => {\n\t\t\t\t\tconst size = block.dataset.size || \"normal\";\n\t\t\t\t\tconst theme = block.dataset.theme || \"light\";\n\n\t\t\t\t\t// Create a container for the reCAPTCHA\n\t\t\t\t\tconst container = document.createElement(\"div\");\n\t\t\t\t\tblock.appendChild(container);\n\n\t\t\t\t\t// Render the reCAPTCHA\n\t\t\t\t\tgrecaptcha.render(container, {\n\t\t\t\t\t\tsitekey: siteKey,\n\t\t\t\t\t\tsize: size,\n\t\t\t\t\t\ttheme: theme,\n\t\t\t\t\t\tcallback: (token) => {\n\t\t\t\t\t\t\tconsole.log(\"reCAPTCHA callback received token:\", token);\n\t\t\t\t\t\t\t// Create a hidden input to store the token\n\t\t\t\t\t\t\tlet input = block.querySelector(\n\t\t\t\t\t\t\t\t'input[name=\"g-recaptcha-response\"]',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (!input) {\n\t\t\t\t\t\t\t\tinput = document.createElement(\"input\");\n\t\t\t\t\t\t\t\tinput.type = \"hidden\";\n\t\t\t\t\t\t\t\tinput.name = \"g-recaptcha-response\";\n\t\t\t\t\t\t\t\tblock.appendChild(input);\n\t\t\t\t\t\t\t\tconsole.log(\"Created new hidden input for token\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinput.value = token;\n\t\t\t\t\t\t\tconsole.log(\"Token stored in hidden input\");\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"error-callback\": () => {\n\t\t\t\t\t\t\tconsole.error(\"reCAPTCHA error occurred\");\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Error initializing reCAPTCHA:\", error);\n\t\t\t\trecaptchaBlocks.forEach((block) => {\n\t\t\t\t\tblock.innerHTML =\n\t\t\t\t\t\t'<p class=\"components-placeholder__error\">Error initializing reCAPTCHA. Please check your site key.</p>';\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tscript.onerror = () => {\n\t\t\trecaptchaBlocks.forEach((block) => {\n\t\t\t\tblock.innerHTML =\n\t\t\t\t\t'<p class=\"components-placeholder__error\">Failed to load reCAPTCHA script.</p>';\n\t\t\t});\n\t\t};\n\n\t\tdocument.head.appendChild(script);\n\t};\n\n\tloadRecaptchaScript();\n});\n"],"names":["document","addEventListener","loadRecaptchaScript","recaptchaBlocks","querySelectorAll","length","siteKey","dataset","sitekey","forEach","block","innerHTML","test","script","createElement","src","async","defer","window","pzCaptchaOnload","size","theme","container","appendChild","grecaptcha","render","callback","token","console","log","input","querySelector","type","name","value","error-callback","error","onerror","head"],"sourceRoot":""}