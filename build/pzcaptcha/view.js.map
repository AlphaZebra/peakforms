{"version":3,"file":"pzcaptcha/view.js","mappings":"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","sources":["webpack://pzforms/./src/pzcaptcha/view.js"],"sourcesContent":["/* global grecaptcha */\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  // Load the reCAPTCHA script dynamically\n  const loadRecaptchaScript = async () => {\n    const recaptchaBlocks = document.querySelectorAll(\n      \".wp-block-pzforms-pzcaptcha\"\n    );\n    if (!recaptchaBlocks.length) return;\n\n    // Get the site key from the first block's data attribute\n    const siteKey = recaptchaBlocks[0].dataset.sitekey;\n\n    // Validate site key format (should be a string of ~40 characters)\n    if (!siteKey || !/^[A-Za-z0-9_-]{30,50}$/.test(siteKey)) {\n      recaptchaBlocks.forEach((block) => {\n        block.innerHTML =\n          '<p class=\"components-placeholder__error\">Invalid reCAPTCHA site key format.</p>';\n      });\n      return;\n    }\n\n    // Load the reCAPTCHA script\n    const script = document.createElement(\"script\");\n    script.src = `https://www.google.com/recaptcha/api.js?onload=pzCaptchaOnload&render=explicit`;\n    script.async = true;\n    script.defer = true;\n\n    // Define the callback function that Google will call when API is ready\n    window.pzCaptchaOnload = function () {\n      try {\n        // Initialize each reCAPTCHA block\n        recaptchaBlocks.forEach((block) => {\n          const size = block.dataset.size || \"normal\";\n          const theme = block.dataset.theme || \"light\";\n\n          // Create a container for the reCAPTCHA\n          const container = document.createElement(\"div\");\n          block.appendChild(container);\n\n          // Render the reCAPTCHA\n          grecaptcha.render(container, {\n            sitekey: siteKey,\n            size: size,\n            theme: theme,\n            callback: (token) => {\n              console.log(\"reCAPTCHA callback received token:\", token);\n              // Create a hidden input to store the token\n              let input = block.querySelector(\n                'input[name=\"g-recaptcha-response\"]'\n              );\n              if (!input) {\n                input = document.createElement(\"input\");\n                input.type = \"hidden\";\n                input.name = \"g-recaptcha-response\";\n                block.appendChild(input);\n                console.log(\"Created new hidden input for token\");\n              }\n              input.value = token;\n              console.log(\"Token stored in hidden input\");\n            },\n            \"error-callback\": () => {\n              console.error(\"reCAPTCHA error occurred\");\n            },\n          });\n        });\n      } catch (error) {\n        console.error(\"Error initializing reCAPTCHA:\", error);\n        recaptchaBlocks.forEach((block) => {\n          block.innerHTML =\n            '<p class=\"components-placeholder__error\">Error initializing reCAPTCHA. Please check your site key.</p>';\n        });\n      }\n    };\n\n    script.onerror = () => {\n      recaptchaBlocks.forEach((block) => {\n        block.innerHTML =\n          '<p class=\"components-placeholder__error\">Failed to load reCAPTCHA script.</p>';\n      });\n    };\n\n    document.head.appendChild(script);\n  };\n\n  loadRecaptchaScript();\n});\n"],"names":["document","addEventListener","loadRecaptchaScript","recaptchaBlocks","querySelectorAll","length","siteKey","dataset","sitekey","test","forEach","block","innerHTML","script","createElement","src","async","defer","window","pzCaptchaOnload","size","theme","container","appendChild","grecaptcha","render","callback","token","console","log","input","querySelector","type","name","value","error-callback","error","onerror","head"],"sourceRoot":""}